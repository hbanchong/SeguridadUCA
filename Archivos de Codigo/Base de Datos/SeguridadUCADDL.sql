CREATE TABLE  "UNIDAD" 
   (	"ID_UNIDAD" NUMBER(9,0) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"UNIDAD_NOMBRE" VARCHAR2(100) NOT NULL ENABLE, 
	 CONSTRAINT "UNIDAD_PK" PRIMARY KEY ("ID_UNIDAD")
  USING INDEX  ENABLE
   )
/
CREATE TABLE  "EMPLEADO" 
   (	"ID_EMPLEADO" NUMBER(9,0) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"NOMBRE_EMPLEADO" VARCHAR2(50) NOT NULL ENABLE, 
	"APELLIDO_EMPLEADO" VARCHAR2(50) NOT NULL ENABLE, 
	"ID_UNIDAD" NUMBER NOT NULL ENABLE, 
	"CODIGO_EMPLEADO" VARCHAR2(20), 
	"CORREO_EMPLEADO" VARCHAR2(250), 
	 CONSTRAINT "EMPLEADO_PK" PRIMARY KEY ("ID_EMPLEADO")
  USING INDEX  ENABLE
   )
/
CREATE TABLE  "VISITANTE" 
   (	"ID_VISITANTE" NUMBER(9,0) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"NOMBRE_VISITANTE" VARCHAR2(50) NOT NULL ENABLE, 
	"APELLIDO_VISITANTE" VARCHAR2(50) NOT NULL ENABLE, 
	"MOTIVO_VISITANTE" VARCHAR2(250) NOT NULL ENABLE, 
	 CONSTRAINT "VISITANTE_PK" PRIMARY KEY ("ID_VISITANTE")
  USING INDEX  ENABLE
   )
/
CREATE TABLE  "TIPO_AFECTADO" 
   (	"ID_TIPO_AFECTADO" NUMBER(9,0) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"NOMBRE_TIPO_AFECTADO" VARCHAR2(50) NOT NULL ENABLE, 
	 CONSTRAINT "TIPO_AFECTADO_PK" PRIMARY KEY ("ID_TIPO_AFECTADO")
  USING INDEX  ENABLE
   )
/
CREATE TABLE  "AFECTADO" 
   (	"ID_AFECTADO" NUMBER(9,0) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"ID_VISITANTE" NUMBER(9,0), 
	"ID_EMPLEADO" NUMBER(9,0), 
	"ID_TIPO_AFECTADO" NUMBER(9,0) NOT NULL ENABLE, 
	 CONSTRAINT "AFECTADO_PK" PRIMARY KEY ("ID_AFECTADO")
  USING INDEX  ENABLE
   )
/
CREATE TABLE  "CATEGORIA_INCIDENTE" 
   (	"ID_CATEGORIA_INCIDENTE" NUMBER(9,0) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"NOMBRE_CATEGORIA_INCIDENTE" VARCHAR2(50) NOT NULL ENABLE, 
	 CONSTRAINT "CATEGORIA_INCIDENTE_PK" PRIMARY KEY ("ID_CATEGORIA_INCIDENTE")
  USING INDEX  ENABLE
   )
/
CREATE TABLE  "TIPO_INCIDENTE" 
   (	"ID_TIPO_INCIDENTE" NUMBER(9,0) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"NOMBRE_TIPO_INCIDENTE" VARCHAR2(50) NOT NULL ENABLE, 
	"ID_CATEGORIA_INCIDENTE" NUMBER NOT NULL ENABLE, 
	 CONSTRAINT "INCIDENTE_PK" PRIMARY KEY ("ID_TIPO_INCIDENTE")
  USING INDEX  ENABLE
   )
/
CREATE TABLE  "LUGAR" 
   (	"ID_LUGAR" NUMBER(9,0) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"NOMBRE_LUGAR" VARCHAR2(250) NOT NULL ENABLE, 
	"GEOMETRIA" "SDO_GEOMETRY", 
	 CONSTRAINT "LUGAR_PK" PRIMARY KEY ("ID_LUGAR")
  USING INDEX  ENABLE
   ) 
 VARRAY "GEOMETRIA"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
 VARRAY "GEOMETRIA"."SDO_ORDINATES" STORE AS SECUREFILE LOB
/
CREATE TABLE  "ESTADO" 
   (	"ID_ESTADO" NUMBER(9,0) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"NOMBRE_ESTADO" VARCHAR2(50) NOT NULL ENABLE, 
	 CONSTRAINT "ESTADO_PK" PRIMARY KEY ("ID_ESTADO")
  USING INDEX  ENABLE
   )
/
CREATE TABLE  "CASO" 
   (	"ID_CASO" NUMBER(9,0) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"FECHA_CASO" TIMESTAMP (6) NOT NULL ENABLE, 
	"DESCRIPCION_CASO" VARCHAR2(250) NOT NULL ENABLE, 
	"ID_ESTADO" NUMBER(9,0) NOT NULL ENABLE, 
	"ID_LUGAR" NUMBER(9,0) NOT NULL ENABLE, 
	"ID_TIPO_INCIDENTE" NUMBER, 
	 CONSTRAINT "CASO_PK" PRIMARY KEY ("ID_CASO")
  USING INDEX  ENABLE
   )
/
CREATE TABLE  "AFECTADO_X_CASO" 
   (	"ID_AFECTADO_X_CASO" NUMBER(9,0) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"ID_AFECTADO" NUMBER(9,0) NOT NULL ENABLE, 
	"ID_CASO" NUMBER(9,0) NOT NULL ENABLE, 
	 CONSTRAINT "AFECTADO_X_CASO_PK" PRIMARY KEY ("ID_AFECTADO_X_CASO")
  USING INDEX  ENABLE
   )
/
ALTER TABLE  "AFECTADO" ADD CONSTRAINT "AFECTADO_EMPLEADO_FK" FOREIGN KEY ("ID_EMPLEADO")
	  REFERENCES  "EMPLEADO" ("ID_EMPLEADO") ENABLE
/
ALTER TABLE  "AFECTADO" ADD CONSTRAINT "AFECTADO_TIPO_FK" FOREIGN KEY ("ID_TIPO_AFECTADO")
	  REFERENCES  "TIPO_AFECTADO" ("ID_TIPO_AFECTADO") ENABLE
/
ALTER TABLE  "AFECTADO" ADD CONSTRAINT "AFECTADO_VISITANTE_FK" FOREIGN KEY ("ID_VISITANTE")
	  REFERENCES  "VISITANTE" ("ID_VISITANTE") ENABLE
/
ALTER TABLE  "AFECTADO_X_CASO" ADD CONSTRAINT "AFECTADO_X_CASO_AFEC_FK" FOREIGN KEY ("ID_AFECTADO")
	  REFERENCES  "AFECTADO" ("ID_AFECTADO") ENABLE
/
ALTER TABLE  "AFECTADO_X_CASO" ADD CONSTRAINT "AFECTADO_X_CASO_CAS_FK" FOREIGN KEY ("ID_CASO")
	  REFERENCES  "CASO" ("ID_CASO") ENABLE
/
ALTER TABLE  "CASO" ADD CONSTRAINT "CASO_ESTADO_FK" FOREIGN KEY ("ID_ESTADO")
	  REFERENCES  "ESTADO" ("ID_ESTADO") ENABLE
/
ALTER TABLE  "CASO" ADD CONSTRAINT "CASO_LUGAR_FK" FOREIGN KEY ("ID_LUGAR")
	  REFERENCES  "LUGAR" ("ID_LUGAR") ENABLE
/
ALTER TABLE  "CASO" ADD CONSTRAINT "CASO_TIPO_INCIDENTE_FK" FOREIGN KEY ("ID_TIPO_INCIDENTE")
	  REFERENCES  "TIPO_INCIDENTE" ("ID_TIPO_INCIDENTE") ENABLE
/
ALTER TABLE  "EMPLEADO" ADD CONSTRAINT "EMPLEADO_UNIDAD_FK" FOREIGN KEY ("ID_UNIDAD")
	  REFERENCES  "UNIDAD" ("ID_UNIDAD") ENABLE
/
ALTER TABLE  "TIPO_INCIDENTE" ADD CONSTRAINT "FK_TIPO_CATEGORIA" FOREIGN KEY ("ID_CATEGORIA_INCIDENTE")
	  REFERENCES  "CATEGORIA_INCIDENTE" ("ID_CATEGORIA_INCIDENTE") ENABLE
/
CREATE UNIQUE INDEX  "AFECTADO_PK" ON  "AFECTADO" ("ID_AFECTADO")
/
CREATE UNIQUE INDEX  "AFECTADO_X_CASO_PK" ON  "AFECTADO_X_CASO" ("ID_AFECTADO_X_CASO")
/
CREATE UNIQUE INDEX  "CASO_PK" ON  "CASO" ("ID_CASO")
/
CREATE UNIQUE INDEX  "CATEGORIA_INCIDENTE_PK" ON  "CATEGORIA_INCIDENTE" ("ID_CATEGORIA_INCIDENTE")
/
CREATE UNIQUE INDEX  "EMPLEADO_PK" ON  "EMPLEADO" ("ID_EMPLEADO")
/
CREATE UNIQUE INDEX  "ESTADO_PK" ON  "ESTADO" ("ID_ESTADO")
/
CREATE UNIQUE INDEX  "INCIDENTE_PK" ON  "TIPO_INCIDENTE" ("ID_TIPO_INCIDENTE")
/
CREATE UNIQUE INDEX  "LUGAR_PK" ON  "LUGAR" ("ID_LUGAR")
/
CREATE UNIQUE INDEX  "TIPO_AFECTADO_PK" ON  "TIPO_AFECTADO" ("ID_TIPO_AFECTADO")
/
CREATE UNIQUE INDEX  "UNIDAD_PK" ON  "UNIDAD" ("ID_UNIDAD")
/
CREATE UNIQUE INDEX  "VISITANTE_PK" ON  "VISITANTE" ("ID_VISITANTE")
/
CREATE OR REPLACE EDITIONABLE PROCEDURE  "UCA_LUGAR_LOAD" (
    p_file_name in VARCHAR2 )
is
    l_lugar_json blob;
begin
    if p_file_name is not null then
            select blob_content
                into l_lugar_json
                from apex_application_temp_files
                where name = p_file_name;
    end if;
    if l_lugar_json is not null then
        insert into lugar (nombre_lugar, geometria )
            ( 
                select nombre_lugar, geometria
                    from json_table(
                        l_lugar_json format json,
                        '$[*]'
                        columns (   
                                    nombre_lugar        varchar2(255)      path '$.name',
                                    geometria           mdsys.sdo_geometry path '$.geometry' ) ) );
    end if;
end;
/

 CREATE SEQUENCE   "AFECTADO_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 341 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL
/
 CREATE SEQUENCE   "AFECTADO_X_CASO_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 341 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL
/
 CREATE SEQUENCE   "CASO_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 321 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL
/
 CREATE SEQUENCE   "CATEGORIA_INCIDENTE_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL
/
 CREATE SEQUENCE   "EMPLEADO_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL
/
 CREATE SEQUENCE   "ESTADO_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL
/
 CREATE SEQUENCE   "INCIDENTE_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL
/
 CREATE SEQUENCE   "LUGAR_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL
/
 CREATE SEQUENCE   "TIPO_AFECTADO_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL
/
 CREATE SEQUENCE   "UNIDAD_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 21 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL
/
 CREATE SEQUENCE   "VISITANTE_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 141 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL
/
CREATE OR REPLACE EDITIONABLE TRIGGER  "BI_AFECTADO" 
  before insert on "AFECTADO"               
  for each row  
begin   
  if :NEW."ID_AFECTADO" is null then 
    select "AFECTADO_SEQ".nextval into :NEW."ID_AFECTADO" from sys.dual; 
  end if; 
end; 

/
ALTER TRIGGER  "BI_AFECTADO" ENABLE
/
CREATE OR REPLACE EDITIONABLE TRIGGER  "BI_AFECTADO_X_CASO" 
  before insert on "AFECTADO_X_CASO"               
  for each row  
begin   
  if :NEW."ID_AFECTADO_X_CASO" is null then 
    select "AFECTADO_X_CASO_SEQ".nextval into :NEW."ID_AFECTADO_X_CASO" from sys.dual; 
  end if; 
end; 

/
ALTER TRIGGER  "BI_AFECTADO_X_CASO" ENABLE
/
CREATE OR REPLACE EDITIONABLE TRIGGER  "BI_CASO" 
  before insert on "CASO"               
  for each row  
begin   
  if :NEW."ID_CASO" is null then 
    select "CASO_SEQ".nextval into :NEW."ID_CASO" from sys.dual; 
  end if; 
end; 

/
ALTER TRIGGER  "BI_CASO" ENABLE
/
CREATE OR REPLACE EDITIONABLE TRIGGER  "BI_CATEGORIA_INCIDENTE" 
  before insert on "CATEGORIA_INCIDENTE"               
  for each row  
begin   
  if :NEW."ID_CATEGORIA_INCIDENTE" is null then 
    select "CATEGORIA_INCIDENTE_SEQ".nextval into :NEW."ID_CATEGORIA_INCIDENTE" from sys.dual; 
  end if; 
end; 

/
ALTER TRIGGER  "BI_CATEGORIA_INCIDENTE" ENABLE
/
CREATE OR REPLACE EDITIONABLE TRIGGER  "BI_EMPLEADO" 
  before insert on "EMPLEADO"               
  for each row  
begin   
  if :NEW."ID_EMPLEADO" is null then 
    select "EMPLEADO_SEQ".nextval into :NEW."ID_EMPLEADO" from sys.dual; 
  end if; 
end; 

/
ALTER TRIGGER  "BI_EMPLEADO" ENABLE
/
CREATE OR REPLACE EDITIONABLE TRIGGER  "BI_ESTADO" 
  before insert on "ESTADO"               
  for each row  
begin   
  if :NEW."ID_ESTADO" is null then 
    select "ESTADO_SEQ".nextval into :NEW."ID_ESTADO" from sys.dual; 
  end if; 
end; 

/
ALTER TRIGGER  "BI_ESTADO" ENABLE
/
CREATE OR REPLACE EDITIONABLE TRIGGER  "BI_INCIDENTE" 
  before insert on "TIPO_INCIDENTE"               
  for each row  
begin   
  if :NEW."ID_TIPO_INCIDENTE" is null then 
    select "INCIDENTE_SEQ".nextval into :NEW."ID_TIPO_INCIDENTE" from sys.dual; 
  end if; 
end; 

/
ALTER TRIGGER  "BI_INCIDENTE" ENABLE
/
CREATE OR REPLACE EDITIONABLE TRIGGER  "BI_LUGAR" 
  before insert on "LUGAR"               
  for each row  
begin   
  if :NEW."ID_LUGAR" is null then 
    select "LUGAR_SEQ".nextval into :NEW."ID_LUGAR" from sys.dual; 
  end if; 
end; 

/
ALTER TRIGGER  "BI_LUGAR" ENABLE
/
CREATE OR REPLACE EDITIONABLE TRIGGER  "BI_TIPO_AFECTADO" 
  before insert on "TIPO_AFECTADO"               
  for each row  
begin   
  if :NEW."ID_TIPO_AFECTADO" is null then 
    select "TIPO_AFECTADO_SEQ".nextval into :NEW."ID_TIPO_AFECTADO" from sys.dual; 
  end if; 
end; 

/
ALTER TRIGGER  "BI_TIPO_AFECTADO" ENABLE
/
CREATE OR REPLACE EDITIONABLE TRIGGER  "BI_UNIDAD" 
  before insert on "UNIDAD"               
  for each row  
begin   
  if :NEW."ID_UNIDAD" is null then 
    select "UNIDAD_SEQ".nextval into :NEW."ID_UNIDAD" from sys.dual; 
  end if; 
end; 

/
ALTER TRIGGER  "BI_UNIDAD" ENABLE
/
CREATE OR REPLACE EDITIONABLE TRIGGER  "BI_VISITANTE" 
  before insert on "VISITANTE"               
  for each row  
begin   
  if :NEW."ID_VISITANTE" is null then 
    select "VISITANTE_SEQ".nextval into :NEW."ID_VISITANTE" from sys.dual; 
  end if; 
end; 

/
ALTER TRIGGER  "BI_VISITANTE" ENABLE
/
